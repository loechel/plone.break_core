# -*- coding: utf-8 -*-

from pkg_resources import parse_version
from pkg_resources import Requirement
from setuptools import package_index

#from plone.vulnerabilitychecks.core.config import VULNERABILITY_DB_URL
#from plone.vulnerabilitychecks.core.config import PYPI_URL

#from plone.vulnerabilitychecks.core.version_utils import parse_version
#from plone.vulnerabilitychecks.core.version_utils import is_final_version
#from plone.vulnerabilitychecks.core.version_utils import is_pre_final_version
from plone.vulnerabilitychecks.core.version_utils import next_larger_dev_version


def getLatestVersion(package='Plone'):
    pi = package_index.PackageIndex(search_path=())
    req = Requirement.parse(package)
    pi.find_packages(req)
    data = pi[req.key][0]
    return data.version


def getLatestBugfixRelease(package='Plone', version='0.0.0'):
    pi = package_index.PackageIndex(search_path=())
    req = Requirement.parse(package)
    pi.find_packages(req)
    data = pi[req.key]
    next_version = next_larger_dev_version(parse_version(version))
    pnext_version = parse_version(next_version)
    for version_item in data:
        this_version = version_item.version
        if pnext_version > parse_version(this_version):
            return this_version
    return version
